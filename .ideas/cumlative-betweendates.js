// var dates = [
//   {
//     start: 5,
//     end: 10
//   },
//   {
//     start: 8,
//     end: 12
//   },
//   {
//     start: 9,
//     end: 10
//   },
//   {
//     start: 10,
//     end: 15
//   },
//   {
//     start: 20,
//     end: 25
//   }
// ];

// var dates = [
//   // Non-deleted
//   {
//     "timestampLocked": 1546364205,
//     "timestampUnlocked": 0,
//     "status": "Locked",
//   },
//   // Deleted
//   {
//     "timestampLocked": 1528138123,
//     "timestampUnlocked": 1528252987,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1528164233,
//     "timestampUnlocked": 1528165143,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1528164653,
//     "timestampUnlocked": 1528184032,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1528264846,
//     "timestampUnlocked": 1528381018,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1528138123,
//     "timestampUnlocked": 1528252987,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1528384975,
//     "timestampUnlocked": 1530151794,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1528656507,
//     "timestampUnlocked": 1530151796,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1529103377,
//     "timestampUnlocked": 1529492586,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1529103377,
//     "timestampUnlocked": 1529492586,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1530286161,
//     "timestampUnlocked": 1538919566,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1530549104,
//     "timestampUnlocked": 0,
//     "status": "Locked",
//   },
//   {
//     "timestampLocked": 1531486992,
//     "timestampUnlocked": 1531534004,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1534796746,
//     "timestampUnlocked": 0,
//     "status": "Locked",
//   },
//   {
//     "timestampLocked": 1537107885,
//     "timestampUnlocked": 0,
//     "status": "Locked",
//   },
//   {
//     "timestampLocked": 1528384975,
//     "timestampUnlocked": 0,
//     "status": "Locked",
//   },
//   {
//     "timestampLocked": 1528656507,
//     "timestampUnlocked": 0,
//     "status": "Locked",
//   },
//   {
//     "timestampLocked": 1537307962,
//     "timestampUnlocked": 1537456671,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1538101718,
//     "timestampUnlocked": 1538105823,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1539637106,
//     "timestampUnlocked": 1541384301,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1542222959,
//     "timestampUnlocked": 1542942358,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1545608673,
//     "timestampUnlocked": 1546363598,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1552608793,
//     "timestampUnlocked": 1552616024,
//     "status": "UnlockedReal",
//   }
// ]

// var dates = [
//   {
//     "timestampLocked": 1546017167,
//     "timestampUnlocked": 1547472506,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1547508624,
//     "timestampUnlocked": 1549942950,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1551397412,
//     "timestampUnlocked": 1551908791,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1554512654,
//     "timestampUnlocked": 1554578372,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1554595441,
//     "timestampUnlocked": 0,
//     "status": "Locked",
//   },
//   {
//     "timestampLocked": 1544224742,
//     "timestampUnlocked": 1544227504,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1544388095,
//     "timestampUnlocked": 1544612436,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1544653598,
//     "timestampUnlocked": 1544793093,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1545087809,
//     "timestampUnlocked": 1545604181,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1547601350,
//     "timestampUnlocked": 1547602197,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1547614094,
//     "timestampUnlocked": 1547632066,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1547772729,
//     "timestampUnlocked": 1547778894,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1548135908,
//     "timestampUnlocked": 1548151682,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1548214169,
//     "timestampUnlocked": 1548243030,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1548798749,
//     "timestampUnlocked": 1548811636,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1549602204,
//     "timestampUnlocked": 1549617577,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1549772446,
//     "timestampUnlocked": 1549792049,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1549857118,
//     "timestampUnlocked": 1549882357,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1550549575,
//     "timestampUnlocked": 1550699239,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1550707651,
//     "timestampUnlocked": 1550890443,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1550806428,
//     "timestampUnlocked": 1550831731,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1550895470,
//     "timestampUnlocked": 1550923205,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1550977110,
//     "timestampUnlocked": 1551003897,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1551069564,
//     "timestampUnlocked": 1551095454,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1551152200,
//     "timestampUnlocked": 1551177409,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1551191472,
//     "timestampUnlocked": 1551390006,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1551235851,
//     "timestampUnlocked": 1551263894,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1551411204,
//     "timestampUnlocked": 1551438037,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1551502674,
//     "timestampUnlocked": 1551527897,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1551587873,
//     "timestampUnlocked": 1551613491,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1551670807,
//     "timestampUnlocked": 1551697221,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1551846725,
//     "timestampUnlocked": 1551873910,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1551919580,
//     "timestampUnlocked": 1552396954,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1551933253,
//     "timestampUnlocked": 1551958460,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1552019924,
//     "timestampUnlocked": 1552046442,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1552105087,
//     "timestampUnlocked": 1552130319,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1552189739,
//     "timestampUnlocked": 1552214944,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1552272407,
//     "timestampUnlocked": 1552297636,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1552358613,
//     "timestampUnlocked": 1552383813,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1552417911,
//     "timestampUnlocked": 1552678902,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1552789970,
//     "timestampUnlocked": 1552915177,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1553050177,
//     "timestampUnlocked": 1553102846,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1553121507,
//     "timestampUnlocked": 1553187827,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1553202774,
//     "timestampUnlocked": 1553370855,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1553375845,
//     "timestampUnlocked": 1553439388,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1553472988,
//     "timestampUnlocked": 1553479636,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1553520246,
//     "timestampUnlocked": 1553596156,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1553613233,
//     "timestampUnlocked": 1553714034,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1553729465,
//     "timestampUnlocked": 1553782514,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1553791876,
//     "timestampUnlocked": 1553961537,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1553984958,
//     "timestampUnlocked": 1554047709,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1554065882,
//     "timestampUnlocked": 1554117843,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1554121077,
//     "timestampUnlocked": 1554216155,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1554246211,
//     "timestampUnlocked": 1554393085,
//     "status": "UnlockedReal",
//   },
//   {
//     "timestampLocked": 1554410166,
//     "timestampUnlocked": 1554491930,
//     "status": "UnlockedReal",
//   }
// ]

var dates = [
  {
    "lockID": 1552077872,
    "lockDeleted": 0,
    "lockedBy": "MissEmma",
    "lockFrozen": 1,
    "timestampLocked": 1552077872,
    "timestampUnlocked": 0,
    "status": "Locked",
    "combination": ""
  },
  {
    "lockID": 1552531619,
    "lockDeleted": 0,
    "lockedBy": "MissEmma",
    "lockFrozen": 0,
    "timestampLocked": 1552531619,
    "timestampUnlocked": 1552541459,
    "status": "UnlockedReal",
    "combination": "944357"
  },
  // Deleted locks
  {
    "lockDeleted": 1,
    "timestampLocked": 1544744803,
    "timestampUnlocked": 0,
    "status": "Locked",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1544745031,
    "timestampUnlocked": 0,
    "status": "Locked",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1544753746,
    "timestampUnlocked": 0,
    "status": "Locked",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1544813430,
    "timestampUnlocked": 1544820233,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1544886209,
    "timestampUnlocked": 0,
    "status": "Locked",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1544889362,
    "timestampUnlocked": 1544922163,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1544924240,
    "timestampUnlocked": 1545164470,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1545169509,
    "timestampUnlocked": 1546904944,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1546973944,
    "timestampUnlocked": 1547626753,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1547595497,
    "timestampUnlocked": 1547604129,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1548003412,
    "timestampUnlocked": 1548868079,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1548869683,
    "timestampUnlocked": 1549996099,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1549997877,
    "timestampUnlocked": 1550059173,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1550062839,
    "timestampUnlocked": 1550490431,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1550539316,
    "timestampUnlocked": 1550547713,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1550618277,
    "timestampUnlocked": 1550623356,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1550723263,
    "timestampUnlocked": 1550724162,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1551151496,
    "timestampUnlocked": 1551179580,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1551404742,
    "timestampUnlocked": 1551961507,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1551961601,
    "timestampUnlocked": 1552015875,
    "status": "UnlockedReal",
  },
  {
    "lockDeleted": 1,
    "timestampLocked": 1552260035,
    "timestampUnlocked": 1552263253,
    "status": "UnlockedReal",
  }
]

// For any dates with a { ... end: 0 } set the 0 to the current timestamp (still active)
dates = dates.map(d => {
  // Insert current date on existing locked locks that are not deleted
  console.log(d.timestampUnlocked === 0 && d.status === 'Locked' && d.lockDeleted === 0, d.timestampLocked)

  if (d.timestampUnlocked === 0 && d.status === 'Locked' && d.lockDeleted === 0) {
    console.log('set to:', Math.round(Date.now() / 1000))
    d.timestampUnlocked = Math.round(Date.now() / 1000)
  }
  return d
})

// Transform data a little
dates = dates.map(d => { return { start: d.timestampLocked, end: d.timestampUnlocked } })

// Ensure they are sorted by start times
dates.sort((a, b) => {
  var x = a.start;
  var y = b.start;
  if (x < y) { return -1; }
  if (x > y) { return 1; }
  return 0;
})

// Sanity check on dates array (negatives)
console.log('=========================')
var negatives = dates.filter(d => (d.end - d.start) < 0)
console.log(`Found (${negatives.length}) that are negatives (excluding active dates)`)
console.log(negatives)
// Remove it/them
for (let index = 0; index < negatives.length; index++) {
  const negativeRange = negatives[index];
  const negativeIndex = dates.findIndex(dd => dd.start === negativeRange.start && dd.end === negativeRange.end)
  console.log('negative index being removed:', negativeRange)
  // Remove
  dates.splice(negativeIndex, 1)
}
console.log('=========================')
console.log(dates)

//////////////////////
///  Actual Code
///////////////////
var cumulative = [];
var cIndex = 0;
var cTime = 0

// Use the first pair in the index as the starting point
cumulative.push(dates[0]);

for (var i = 1; i < dates.length; i++) {
  // Complete overlap, remove from consideration
  if (
    dates[i].start >= cumulative[cIndex].start &&
    dates[i].end <= cumulative[cIndex].end
  ) {
    console.log(`index: ${i}, Condition 1 Met (Skip)`, dates[i]);
    continue; // Stop here
  }

  // New range beyond current range - set new range
  if (dates[i].start >= cumulative[cIndex].end) {
    console.log(`index: ${i}, Condition 3 Met (New)`, dates[i]);
    cIndex++;
    cumulative.push(dates[i]);
    continue; // Stop here
  }

  // Extend the current range
  if (
    dates[i].start >= cumulative[cIndex].start &&
    dates[i].end > cumulative[cIndex].end
  ) {
    console.log(`index: ${i}, Condition 2 Met (Extend)`, dates[i]);
    cumulative[cIndex].end = dates[i].end;
    continue; // Stop here
  }

  // All unmatched
  console.log('Unmatched range:', dates[i], 'current cumulative:', cumulative[cIndex]);
}

// Calculate sums
cTime = cumulative.reduce((s, c) => s += c.end - c.start, 0)

//////////////////////
///  Actual Code END
///////////////////

// Print results
console.log('=========================')
console.log(`Started with ${dates.length} ranges (${dates.reduce((s, c) => s += c.end - c.start, 0)}), reduced to ${cumulative.length}`)
console.log('results:', cumulative);
console.log(`cumulative time: ${cTime} seconds, (${cTime / 2592000})`)
