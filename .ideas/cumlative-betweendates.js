// var dates = [
//   {
//     start: 5,
//     end: 10
//   },
//   {
//     start: 8,
//     end: 12
//   },
//   {
//     start: 9,
//     end: 10
//   },
//   {
//     start: 10,
//     end: 15
//   },
//   {
//     start: 20,
//     end: 25
//   }
// ];

var dates = [
  // Non-deleted
  {
    "lockID": 1546017167,
    "timestampLocked": 1546017167,
    "timestampUnlocked": 1547472506,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1547508624,
    "timestampLocked": 1547508624,
    "timestampUnlocked": 1549942950,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1551397412,
    "timestampLocked": 1551397412,
    "timestampUnlocked": 1551908791,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1554410166,
    "timestampLocked": 1554410166,
    "timestampUnlocked": 1554491930,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1554512654,
    "timestampLocked": 1554512654,
    "timestampUnlocked": 0,
    "status": "Locked",
  },
  // Deleted
  {
    "lockID": 1544224742,
    "timestampLocked": 1544224742,
    "timestampUnlocked": 1544227504,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1544388095,
    "timestampLocked": 1544388095,
    "timestampUnlocked": 1544612436,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1544653598,
    "timestampLocked": 1544653598,
    "timestampUnlocked": 1544793093,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1545087809,
    "timestampLocked": 1545087809,
    "timestampUnlocked": 1545604181,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1547601350,
    "timestampLocked": 1547601350,
    "timestampUnlocked": 1547602197,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1547614094,
    "timestampLocked": 1547614094,
    "timestampUnlocked": 1547632066,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1547772729,
    "timestampLocked": 1547772729,
    "timestampUnlocked": 1547778894,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1548135908,
    "timestampLocked": 1548135908,
    "timestampUnlocked": 1548151682,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1548214169,
    "timestampLocked": 1548214169,
    "timestampUnlocked": 1548243030,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1548798749,
    "timestampLocked": 1548798749,
    "timestampUnlocked": 1548811636,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1549602204,
    "timestampLocked": 1549602204,
    "timestampUnlocked": 1549617577,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1549772446,
    "timestampLocked": 1549772446,
    "timestampUnlocked": 1549792049,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1549857118,
    "timestampLocked": 1549857118,
    "timestampUnlocked": 1549882357,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1550549575,
    "timestampLocked": 1550549575,
    "timestampUnlocked": 1550699239,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1550707651,
    "timestampLocked": 1550707651,
    "timestampUnlocked": 1550890443,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1550806428,
    "timestampLocked": 1550806428,
    "timestampUnlocked": 1550831731,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1550895470,
    "timestampLocked": 1550895470,
    "timestampUnlocked": 1550923205,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1550977110,
    "timestampLocked": 1550977110,
    "timestampUnlocked": 1551003897,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1551069564,
    "timestampLocked": 1551069564,
    "timestampUnlocked": 1551095454,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1551152200,
    "timestampLocked": 1551152200,
    "timestampUnlocked": 1551177409,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1551191472,
    "timestampLocked": 1551191472,
    "timestampUnlocked": 1551390006,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1551235851,
    "timestampLocked": 1551235851,
    "timestampUnlocked": 1551263894,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1551411204,
    "timestampLocked": 1551411204,
    "timestampUnlocked": 1551438037,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1551502674,
    "timestampLocked": 1551502674,
    "timestampUnlocked": 1551527897,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1551587873,
    "timestampLocked": 1551587873,
    "timestampUnlocked": 1551613491,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1551670807,
    "timestampLocked": 1551670807,
    "timestampUnlocked": 1551697221,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1551846725,
    "timestampLocked": 1551846725,
    "timestampUnlocked": 1551873910,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1551919580,
    "timestampLocked": 1551919580,
    "timestampUnlocked": 1552396954,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1551933253,
    "timestampLocked": 1551933253,
    "timestampUnlocked": 1551958460,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1552019924,
    "timestampLocked": 1552019924,
    "timestampUnlocked": 1552046442,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1552105087,
    "timestampLocked": 1552105087,
    "timestampUnlocked": 1552130319,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1552189739,
    "timestampLocked": 1552189739,
    "timestampUnlocked": 1552214944,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1552272407,
    "timestampLocked": 1552272407,
    "timestampUnlocked": 1552297636,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1552358613,
    "timestampLocked": 1552358613,
    "timestampUnlocked": 1552383813,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1552417911,
    "timestampLocked": 1552417911,
    "timestampUnlocked": 1552678902,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1552789970,
    "timestampLocked": 1552789970,
    "timestampUnlocked": 1552915177,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1553050177,
    "timestampLocked": 1553050177,
    "timestampUnlocked": 1553102846,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1553121507,
    "timestampLocked": 1553121507,
    "timestampUnlocked": 1553187827,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1553202774,
    "timestampLocked": 1553202774,
    "timestampUnlocked": 1553370855,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1553375845,
    "timestampLocked": 1553375845,
    "timestampUnlocked": 1553439388,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1553472988,
    "timestampLocked": 1553472988,
    "timestampUnlocked": 1553479636,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1553520246,
    "timestampLocked": 1553520246,
    "timestampUnlocked": 1553596156,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1553613233,
    "timestampLocked": 1553613233,
    "timestampUnlocked": 1553714034,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1553729465,
    "timestampLocked": 1553729465,
    "timestampUnlocked": 1553782514,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1553791876,
    "timestampLocked": 1553791876,
    "timestampUnlocked": 1553961537,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1553984958,
    "timestampLocked": 1553984958,
    "timestampUnlocked": 1554047709,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1554065882,
    "timestampLocked": 1554065882,
    "timestampUnlocked": 1554117843,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1554121077,
    "timestampLocked": 1554121077,
    "timestampUnlocked": 1554216155,
    "status": "UnlockedReal",
  },
  {
    "lockID": 1554246211,
    "timestampLocked": 1554246211,
    "timestampUnlocked": 1554393085,
    "status": "UnlockedReal",
  }
]

// Transform data a little
dates = dates.map(d => { return { start: d.timestampLocked, end: d.timestampUnlocked } })
// Ensure they are sorted by start times
dates.sort((a, b) => {
  var x = a.start;
  var y = b.start;
  if (x < y) { return -1; }
  if (x > y) { return 1; }
  return 0;
})

// Sanity check on dates array (negatives)
console.log('=========================')
var negatives = dates.filter((d, i) => (d.end - d.start) < 0)
console.log(`Found (${negatives.length}) that are negatives`)
console.log(negatives)
// Remove it/them
var negativeIndexes = negatives.map(d => dates.findIndex(dd => dd.start === d.start))
console.log('negative indexes removed:', negativeIndexes)
// Remove
negativeIndexes.forEach(ni => dates.splice(ni, 1))
console.log('=========================')

//////////////////////
///  Actual Code
///////////////////
var cumlative = [];
var cIndex = 0;
var cTime = 0

// Use the first pair in the index as the starting point
cumlative.push(dates[0]);

for (var i = 1; i < dates.length; i++) {
  //console.log('Checking:', dates[i], ', against', cumlative[cIndex]);
  // Complete overlap, remove from consideration
  if (
    dates[i].start > cumlative[cIndex].start &&
    dates[i].end < cumlative[cIndex].end
  ) {
    console.log(`index: ${i}, Condition 1 Met (Skip)`);
    continue; // Stop here
  }

  // New range beyond current range - set new range
  if (dates[i].start >= cumlative[cIndex].end) {
    console.log(`index: ${i}, Condition 3 Met (New)`);
    cIndex++;
    cumlative.push(dates[i]);
    continue; // Stop here
  }

  // Extend the current range
  if (
    dates[i].start >= cumlative[cIndex].start &&
    dates[i].end > cumlative[cIndex].end
  ) {
    console.log(`index: ${i}, Condition 2 Met (Extend)`);
    cumlative[cIndex].end = dates[i].end;
    continue; // Stop here
  }

  // All unmatched
  console.log('Unmatched range:', dates[i]);
}

// Calculate sums
cTime = cumlative.reduce((s, c) => s += c.end - c.start, 0)

//////////////////////
///  Actual Code END
///////////////////

// Print results
console.log('=========================')
console.log(`Started with ${dates.length} ranges (${dates.reduce((s, c) => s += c.end - c.start, 0)}), reduced to ${cumlative.length}`)
console.log('results:', cumlative);
console.log(`cumlative time: ${cTime} seconds, (${cTime / 2592000})`)
